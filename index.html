<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>Yoav's Physics Notes</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>

<!-- HEADER -->
<div include-html="header.html"></div>

<!-- CONTENT -->
<div id="tree-container">
  <div id="content">טוען…</div>
</div>

<!-- FOOTER -->
<div include-html="footer.html" id="site-footer"></div>

<script src="include.js"></script>

<script>
  async function loadTree() {
    const res = await fetch("https://raw.githubusercontent.com/YoavsPhysicsNotes/yoavsphysicsnotes.github.io/main/tree.json?ts=" + Date.now());
    return await res.json();
  }

  function renderNode(node) {
    if (node.type === "pdf") {
      const wrapper = document.createElement("div");
      wrapper.className = "pdf-row";

      const icon = document.createElement("span");
      icon.className = "icon pdf";

      const a = document.createElement("a");
      a.className = "pdf-link";
      a.href = "https://cdn.jsdelivr.net/gh/YoavsPhysicsNotes/yoavsphysicsnotes.github.io/" + node.path;
      a.target = "_blank";
      a.textContent = node.name.replace(/\.pdf$/i, "");

      const dateSpan = document.createElement("span");
      if (node.last_modified) {
        const d = new Date(node.last_modified);
        dateSpan.className = "file-date";
        dateSpan.textContent =
                "תאריך עדכון: " +
                d.toLocaleDateString("he-IL") +
                " " +
                d.toLocaleTimeString("he-IL", { hour: "2-digit", minute: "2-digit" });
      }

      wrapper.appendChild(icon);
      wrapper.appendChild(a);
      wrapper.appendChild(dateSpan);

      return wrapper;
    }

    if (node.type === "dir") {
      const det = document.createElement("details");
      const sum = document.createElement("summary");

      const icon = document.createElement("span");
      icon.className = "icon folder";

      sum.prepend(icon);
      sum.append(node.name);
      det.appendChild(sum);

      node.children.forEach(child => det.appendChild(renderNode(child)));
      return det;
    }
  }

  async function load() {
    const tree = await loadTree();
    const content = document.getElementById("content");
    content.innerHTML = "";
    tree.forEach(node => {
      if (!node.name.startsWith(".")) content.appendChild(renderNode(node));
    });
  }

  load();
</script>

</body>
</html>