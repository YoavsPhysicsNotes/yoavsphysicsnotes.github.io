<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <link rel="icon" href="favicon.png" type="image/png">
  <title>Yoav's Physics Notes</title>

  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI";
      max-width: 800px;
      margin: 40px auto;
      padding: 0 16px;
      direction: rtl;
      text-align: right;
      background: #111;
      color: #fff;
    }

    .logo-wrap {
      display: flex;
      justify-content: center;
      margin-bottom: 16px;
    }

    .logo-wrap img {
      max-height: 90px;
      border-radius: 6px;
    }

    details {
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 0.4rem 0.8rem 0.6rem;
      margin-bottom: 0.6rem;
    }

    summary {
      font-weight: 600;
      cursor: pointer;
      list-style: none;
      outline: none;
      font-size: 1rem;
    }

    summary::-webkit-details-marker {
      display: none;
    }

    /* חץ RTL — סגור: שמאלה, פתוח: למטה */
    details > summary::before {
      content: "▸";
      display: inline-block;
      margin-left: 6px;
      transform: rotate(180deg); /* מצב סגור – שמאלה */
      transition: transform 0.15s ease-out;
      color: #ccc;
    }

    details[open] > summary::before {
      transform: rotate(90deg); /* מצב פתוח – למטה */
    }

    .pdf-item {
      margin: 0.25rem 0;
      padding-right: 1.2rem;
    }

    .pdf-link {
      text-decoration: none;
      color: #6aa6ff;
      font-size: 0.96rem;
    }

    .pdf-link:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>

  <div class="logo-wrap">
    <img src="logo.png" alt="Yoav's Physics Notes">
  </div>

  <div id="content">טוען…</div>

<script>
const owner = "YoavsPhysicsNotes";
const repo  = "yoavsphysicsnotes.github.io";
const proxy = "https://api.allorigins.win/raw?url=";

async function get(path = "") {
  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
  const res = await fetch(proxy + encodeURIComponent(url));
  return res.ok ? await res.json() : [];
}

async function getLastModified(path) {
  const url = `https://api.github.com/repos/${owner}/${repo}/commits?path=${encodeURIComponent(path)}&page=1&per_page=1`;
  const res = await fetch(proxy + encodeURIComponent(url));
  if (!res.ok) return null;
  const commits = await res.json();
  if (commits.length === 0) return null;
  return commits[0].commit.author.date;
}

function isPdf(f) { return f.type === "file" && f.name.toLowerCase().endsWith(".pdf"); }
function isDir(f) { return f.type === "dir"; }

/* רינדור תיקייה עם עומק בלתי מוגבל */
async function renderFolder(path, name) {
  if (name.startsWith(".")) return document.createDocumentFragment();
  const det = document.createElement("details");
  const sum = document.createElement("summary");
  sum.textContent = name;
  det.appendChild(sum);

  const items = await get(path);
  const dirs  = items.filter(isDir);
  const pdfs  = items.filter(isPdf);

  /* קבצי PDF בתיקייה */
  pdfs.forEach(f => {
    const div = document.createElement("div");
    div.className = "pdf-item";

    const a = document.createElement("a");
    a.className = "pdf-link";
    a.href = f.download_url;
    a.target = "_blank";
    a.textContent = f.name.replace(/\.pdf$/i, "");

    div.appendChild(a);

    const dateSpan = document.createElement("span");
    dateSpan.style.color = "#bbb";
    dateSpan.style.fontSize = "0.85rem";
    getLastModified(f.path).then(d => {
      if (d) {
        const date = new Date(d);
        const dd = String(date.getDate()).padStart(2, '0');
        const mm = String(date.getMonth() + 1).padStart(2, '0');
        const yy = String(date.getFullYear()).slice(-2);
        const hh = String(date.getHours()).padStart(2, '0');
        const min = String(date.getMinutes()).padStart(2, '0');
        dateSpan.textContent = ` (${dd}-${mm}-${yy}, ${hh}:${min})`;
      }
    });
    div.appendChild(dateSpan);

    det.appendChild(div);
  });

  /* תתי־תיקיות (קריאה רקורסיבית) */
  for (const d of dirs) {
    const sub = await renderFolder(d.path, d.name);
    sub.style.marginRight = "1rem";
    det.appendChild(sub);
  }

  return det;
}

async function load() {
  const container = document.getElementById("content");
  container.innerHTML = "";

  const root = await get("");
  const dirs = root.filter(isDir);
  const rootPdfs = root.filter(isPdf);

  /* קבצים כלליים */
  if (rootPdfs.length > 0) {
    const gen = document.createElement("details");
    gen.open = true;

    const sum = document.createElement("summary");
    sum.textContent = "קבצים כלליים";
    gen.appendChild(sum);

    rootPdfs.forEach(f => {
      const div = document.createElement("div");
      div.className = "pdf-item";

      const a = document.createElement("a");
      a.className = "pdf-link";
      a.href = f.download_url;
      a.target = "_blank";
      a.textContent = f.name.replace(/\.pdf$/i, "");

      div.appendChild(a);

      const dateSpan = document.createElement("span");
      dateSpan.style.color = "#bbb";
      dateSpan.style.fontSize = "0.85rem";
      getLastModified(f.path).then(d => {
        if (d) {
          const date = new Date(d);
          const dd = String(date.getDate()).padStart(2, '0');
          const mm = String(date.getMonth() + 1).padStart(2, '0');
          const yy = String(date.getFullYear()).slice(-2);
          const hh = String(date.getHours()).padStart(2, '0');
          const min = String(date.getMinutes()).padStart(2, '0');
          dateSpan.textContent = ` (${dd}-${mm}-${yy}, ${hh}:${min})`;
        }
      });
      div.appendChild(dateSpan);

      gen.appendChild(div);
    });

    container.appendChild(gen);
  }

  /* תיקיות ברמה הראשונה */
  for (const d of dirs) {
    if (d.name.startsWith(".")) continue;
    const block = await renderFolder(d.path, d.name);
    container.appendChild(block);
  }

}
load();

</script>
</body>
</html>
