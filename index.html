<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8" />
  <title>Yoav's Physics Notes</title>
  <link rel="stylesheet" href="style.css" />

</head>
<body>
  <!-- force refresh -->
  <div id="header-placeholder"></div>
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("header-placeholder").innerHTML = html;
      });
  </script>
<div id="tree-container">
  <div id="content">טוען…</div>
</div>
<script>
async function loadTree() {
  const res = await fetch("https://raw.githubusercontent.com/YoavsPhysicsNotes/yoavsphysicsnotes.github.io/main/tree.json?ts=" + Date.now());
  return await res.json();
}

function renderNode(node) {
  if (node.type === "pdf") {
    const div = document.createElement("div");
    div.className = "pdf-item";
    const a = document.createElement("a");
    a.className = "pdf-link";
    a.href = "https://cdn.jsdelivr.net/gh/YoavsPhysicsNotes/yoavsphysicsnotes.github.io/" + node.path;
    a.target = "_blank";
    // Remove dateText from the link text
    a.textContent = node.name.replace(/\.pdf$/i, "");
    // Add date as a separate span aligned left
    if (node.last_modified) {
      const dateSpan = document.createElement("span");
      const d = new Date(node.last_modified);
      dateSpan.className = "file-date";
      dateSpan.textContent = "תאריך עדכון: " +
        d.toLocaleDateString("he-IL") + " " +
        d.toLocaleTimeString("he-IL", { hour: "2-digit", minute: "2-digit" });

      const wrapper = document.createElement("div");
      wrapper.className = "pdf-row";
      wrapper.appendChild(a);
      wrapper.appendChild(dateSpan);
      // Add PDF icon
      const icon = document.createElement("span");
      icon.className = "icon pdf";
      wrapper.prepend(icon);
      return wrapper;
    }
    // Add PDF icon for items without date
    const icon = document.createElement("span");
    icon.className = "icon pdf";
    div.appendChild(a);
    div.prepend(icon);
    return div;
  }

  if (node.type === "dir") {
    const det = document.createElement("details");
    const sum = document.createElement("summary");
    const dateText = "";
    sum.textContent = node.name + dateText;
    // Add folder icon
    const icon = document.createElement("span");
    icon.className = "icon folder";
    sum.prepend(icon);
    det.appendChild(sum);

    node.children.forEach(child => {
      det.appendChild(renderNode(child));
    });

    return det;
  }
}

async function load() {
  const tree = await loadTree();
  const container = document.getElementById("content");
  container.innerHTML = "";

  tree.forEach(node => { if (!node.name.startsWith(".")) container.appendChild(renderNode(node)); });
}

load();
</script>
</html>